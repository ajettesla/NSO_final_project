#!/bin/bash

# Source the OpenStack credentials
source /opt/openrc_file

FLOATING_IP={{ floatingIp.haproxy }}  # Replace with your floating IP

INSTANCE_ID=$(hostname -f)

if [ $INSTANCE_ID == "proxy-1" ]; then
    INSTANCE_ID="proxy_1"
    ANOTHER_INSTANCE_ID="proxy_2"
else
    INSTANCE_ID="proxy_2"
    ANOTHER_INSTANCE_ID="proxy_1"
fi


ACTION=$1

if [ "$ACTION" == "master" ]; then
    openstack server remove floating ip "$ANOTHER_INSTANCE_ID" "$FLOATING_IP"
    openstack server add floating ip "$INSTANCE_ID" "$FLOATING_IP"
elif [ "$ACTION" == "backup" ]; then
    openstack server remove floating ip "$ANOTHER_INSTANCE_ID" "$FLOATING_IP"
    openstack server add floating ip "$INSTANCE_ID" "$FLOATING_IP"

fi

