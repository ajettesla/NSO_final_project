#!/bin/bash

# Source the OpenStack credentials
source /opt/openrc_file

# Define the floating IP
FLOATING_IP="{{ floatingIp.haproxy }}"  # Ensure this is interpolated correctly

# Determine the hostname and set the IDs
if [[ "$(hostname -f)" == "proxy-1" ]]; then
    ID="proxy_1"
    AID="proxy_2"
else
    ID="proxy_2"
    AID="proxy_1"
fi

# Check if the floating IP is assigned to the current host
if ip addr show | grep -q "$FLOATING_IP"; then 
    openstack server remove floating ip "$AID" "$FLOATING_IP"
    openstack server add floating ip "$ID" "$FLOATING_IP"
else
    openstack server remove floating ip "$ID" "$FLOATING_IP"
    openstack server add floating ip "$AID" "$FLOATING_IP"
fi

